<!DOCTYPE html>
<html> 
    <head> 
        <link rel="stylesheet" type="text/css" href="STYLE.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
        <script type="text/javascript" src="Resources/three.min.js"></script>
      <!--  <script type="text/javascript" src="Resources/p5.min.js"></script>
        <script type="text/javascript" src="Resources/p5.dom.js"></script> -->
        <style>
            body {margin: 0;}
            canvas {width: 100%; height: 100%}
        </style>
    </head> 
    <body>
        <div id="ISStitle"><p>ISS LOCATION</p></div>
        <div id="LAT"></div>
        <div id="LONG"></div>
        <div id="DISPLAY"></div>
        
        <script>
            
            
//******GET LAT AND LONG OF ISS            
            function GetValue() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var requestResponse = xhr.responseText;
                    var issInfo = JSON.parse(requestResponse);
                    var Lat = issInfo.iss_position.latitude;
                    var Long = issInfo.iss_position.longitude;
                    callback(Lat, Long); //Calls function to print to console and divs
                    ReverseGeoCode(Lat, Long); //Call to reverse geocode
                }
            };
            xhr.open("GET", "http://api.open-notify.org/iss-now.json", true);
            xhr.send();
        }
//
//****PRINT LAT AND LONG TO CONSOLE AND DIVS*****            
            function callback(Lat, Long) {
                console.log(Lat); 
                console.log(Long);
                document.getElementById('LAT').innerHTML = 'Lat: ' + Lat;
                document.getElementById('LONG').innerHTML = 'Long: ' + Long;
            }
//            
            GetValue(); //
            setInterval(GetValue, 5000); //Repeat every 5 seconds
            
            
            
// *******REVERSE GEOCODING TO FIND LOCATION*******            
function ReverseGeoCode (Lat, Long) {        
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "https://locationiq.org/v1/reverse.php?format=json&key=99b55a157aa255&lat="+Lat+"&lon="+Long, true);
            xhr.send();
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var requestResponse = xhr.responseText; //Store full response in var
                    var geoCodeInfo = JSON.parse(requestResponse); //turn received information into a javascript object
                    if (geoCodeInfo.error) {
                        var Display = "somewhere over an ocean"; //NEED TO MAKE THIS MORE SPECIFIC, FIND LAT AND LONG OF OCEANS OF THE WORLD   
                    } else {
                        var Display = geoCodeInfo.display_name; //Set display name to var
                    }
                    console.log(geoCodeInfo);
                    document.getElementById('DISPLAY').innerHTML = Display; //print to div
                }
            };
} 
        </script>
        
    </body> 
</html>
